generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Chat {
  id        String    @id
  name      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime
  avatarUrl String?   @unique
  type      ChatType  @default(direct)
  File      File?     @relation(fields: [avatarUrl], references: [url])
  Invite    Invite[]
  Message   Message[]
  User      User[]    @relation("ChatMembers")
}

model File {
  id                        String   @id
  url                       String   @unique
  type                      String
  size                      Int
  folder                    String?
  createdAt                 DateTime @default(now())
  authorId                  String
  messageId                 String?
  Chat                      Chat?
  User_File_authorIdToUser  User     @relation("File_authorIdToUser", fields: [authorId], references: [id], onDelete: Cascade)
  Message                   Message? @relation(fields: [messageId], references: [id], onDelete: Cascade)
  User_User_avatarUrlToFile User?    @relation("User_avatarUrlToFile")
}

model Invite {
  id                           String   @id
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime
  chatId                       String
  senderId                     String
  receiverId                   String
  Chat                         Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  User_Invite_receiverIdToUser User     @relation("Invite_receiverIdToUser", fields: [receiverId], references: [id], onDelete: Cascade)
  User_Invite_senderIdToUser   User     @relation("Invite_senderIdToUser", fields: [senderId], references: [id], onDelete: Cascade)
}

model Message {
  id        String   @id
  text      String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  authorId  String
  chatId    String
  File      File[]
  User      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  Chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

model User {
  id                             String    @id
  name                           String
  email                          String    @unique
  phone                          String?   @unique
  password                       String
  username                       String    @unique
  otp                            String?
  twoFactorAuth                  Boolean   @default(false)
  lastEmailChange                DateTime  @default(now())
  createdAt                      DateTime  @default(now())
  updatedAt                      DateTime
  avatarUrl                      String?   @unique
  File_File_authorIdToUser       File[]    @relation("File_authorIdToUser")
  Invite_Invite_receiverIdToUser Invite[]  @relation("Invite_receiverIdToUser")
  Invite_Invite_senderIdToUser   Invite[]  @relation("Invite_senderIdToUser")
  Message                        Message[]
  File_User_avatarUrlToFile      File?     @relation("User_avatarUrlToFile", fields: [avatarUrl], references: [url])
  Chat                           Chat[]    @relation("ChatMembers")
}

enum ChatType {
  direct
  group
}
